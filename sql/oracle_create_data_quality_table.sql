-- Data Quality Checking Results Table for rLCIS Migration
-- Records the results of data quality checks after ETL transfer operations

CREATE TABLE DATA_QUALITY_CHECKING_RLCIS (
    CHECK_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TABLE_NAME VARCHAR2(128) NOT NULL,
    SOURCE_TABLE VARCHAR2(128) NOT NULL,
    CHECK_TYPE VARCHAR2(50) NOT NULL, -- 'ROW_COUNT' or 'CONTENT_COMPARISON'
    CHECK_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    
    -- Row count check fields
    SOURCE_ROW_COUNT NUMBER,
    TARGET_ROW_COUNT NUMBER,
    ROW_COUNT_MATCH CHAR(1) CHECK (ROW_COUNT_MATCH IN ('Y', 'N')),
    
    -- Content comparison fields
    SAMPLE_SIZE NUMBER,
    SAMPLE_PERCENTAGE NUMBER(5,4), -- e.g., 0.1000 for 10%
    COLUMNS_CHECKED NUMBER,
    COLUMNS_MATCHED NUMBER,
    CONTENT_MATCH_PERCENTAGE NUMBER(5,2), -- e.g., 95.50 for 95.5%
    
    -- Overall result
    CHECK_STATUS VARCHAR2(20) NOT NULL CHECK (CHECK_STATUS IN ('PASSED', 'FAILED', 'WARNING')),
    ERROR_MESSAGE CLOB,
    
    -- Performance tracking
    CHECK_DURATION_SECONDS NUMBER(10,2),
    
    -- Additional metadata
    ETL_SESSION_ID VARCHAR2(100), -- Can link to broader ETL session
    CREATED_BY VARCHAR2(50) DEFAULT 'ETL_SYSTEM',
    
    CONSTRAINT chk_row_count_logic 
        CHECK (CHECK_TYPE != 'ROW_COUNT' OR (SOURCE_ROW_COUNT IS NOT NULL AND TARGET_ROW_COUNT IS NOT NULL)),
    CONSTRAINT chk_content_logic 
        CHECK (CHECK_TYPE != 'CONTENT_COMPARISON' OR (SAMPLE_SIZE IS NOT NULL AND COLUMNS_CHECKED IS NOT NULL))
)